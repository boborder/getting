var St=Object.defineProperty;var Me=t=>{throw TypeError(t)};var kt=(t,e,r)=>e in t?St(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r;var d=(t,e,r)=>kt(t,typeof e!="symbol"?e+"":e,r),Ce=(t,e,r)=>e.has(t)||Me("Cannot "+r);var a=(t,e,r)=>(Ce(t,e,"read from private field"),r?r.call(t):e.get(t)),g=(t,e,r)=>e.has(t)?Me("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(t):e.set(t,r),f=(t,e,r,s)=>(Ce(t,e,"write to private field"),s?s.call(t,r):e.set(t,r),r),p=(t,e,r)=>(Ce(t,e,"access private method"),r);var qe=(t,e,r,s)=>({set _(n){f(t,e,n,r)},get _(){return a(t,e,s)}});var Ue=(t,e,r)=>(s,n)=>{let i=-1;return o(0);async function o(h){if(h<=i)throw new Error("next() called multiple times");i=h;let c,u=!1,l;if(t[h]?(l=t[h][0][0],s.req.routeIndex=h):l=h===t.length&&n||void 0,l)try{c=await l(s,()=>o(h+1))}catch(y){if(y instanceof Error&&e)s.error=y,c=await e(y,s),u=!0;else throw y}else s.finalized===!1&&r&&(c=await r(s));return c&&(s.finalized===!1||u)&&(s.res=c),s}},jt=async(t,e=Object.create(null))=>{const{all:r=!1,dot:s=!1}=e,i=(t instanceof ut?t.raw.headers:t.headers).get("Content-Type");return i!=null&&i.startsWith("multipart/form-data")||i!=null&&i.startsWith("application/x-www-form-urlencoded")?At(t,{all:r,dot:s}):{}};async function At(t,e){const r=await t.formData();return r?Lt(r,e):{}}function Lt(t,e){const r=Object.create(null);return t.forEach((s,n)=>{e.all||n.endsWith("[]")?$t(r,n,s):r[n]=s}),e.dot&&Object.entries(r).forEach(([s,n])=>{s.includes(".")&&(Ct(r,s,n),delete r[s])}),r}var $t=(t,e,r)=>{t[e]!==void 0?Array.isArray(t[e])?t[e].push(r):t[e]=[t[e],r]:t[e]=r},Ct=(t,e,r)=>{let s=t;const n=e.split(".");n.forEach((i,o)=>{o===n.length-1?s[i]=r:((!s[i]||typeof s[i]!="object"||Array.isArray(s[i])||s[i]instanceof File)&&(s[i]=Object.create(null)),s=s[i])})},it=t=>{const e=t.split("/");return e[0]===""&&e.shift(),e},_t=t=>{const{groups:e,path:r}=Dt(t),s=it(r);return Ht(s,e)},Dt=t=>{const e=[];return t=t.replace(/\{[^}]+\}/g,(r,s)=>{const n=`@${s}`;return e.push([n,r]),n}),{groups:e,path:t}},Ht=(t,e)=>{for(let r=e.length-1;r>=0;r--){const[s]=e[r];for(let n=t.length-1;n>=0;n--)if(t[n].includes(s)){t[n]=t[n].replace(s,e[r][1]);break}}return t},Oe={},We=(t,e)=>{if(t==="*")return"*";const r=t.match(/^\:([^\{\}]+)(?:\{(.+)\})?$/);if(r){const s=`${t}#${e}`;return Oe[s]||(r[2]?Oe[s]=e&&e[0]!==":"&&e[0]!=="*"?[s,r[1],new RegExp(`^${r[2]}(?=/${e})`)]:[t,r[1],new RegExp(`^${r[2]}$`)]:Oe[s]=[t,r[1],!0]),Oe[s]}return null},at=(t,e)=>{try{return e(t)}catch{return t.replace(/(?:%[0-9A-Fa-f]{2})+/g,r=>{try{return e(r)}catch{return r}})}},It=t=>at(t,decodeURI),ot=t=>{const e=t.url,r=e.indexOf("/",8);let s=r;for(;s<e.length;s++){const n=e.charCodeAt(s);if(n===37){const i=e.indexOf("?",s),o=e.slice(r,i===-1?void 0:i);return It(o.includes("%25")?o.replace(/%25/g,"%2525"):o)}else if(n===63)break}return e.slice(r,s)},Nt=t=>{const e=ot(t);return e.length>1&&e.at(-1)==="/"?e.slice(0,-1):e},ie=(t,e,...r)=>(r.length&&(e=ie(e,...r)),`${(t==null?void 0:t[0])==="/"?"":"/"}${t}${e==="/"?"":`${(t==null?void 0:t.at(-1))==="/"?"":"/"}${(e==null?void 0:e[0])==="/"?e.slice(1):e}`}`),ct=t=>{if(t.charCodeAt(t.length-1)!==63||!t.includes(":"))return null;const e=t.split("/"),r=[];let s="";return e.forEach(n=>{if(n!==""&&!/\:/.test(n))s+="/"+n;else if(/\:/.test(n))if(/\?/.test(n)){r.length===0&&s===""?r.push("/"):r.push(s);const i=n.replace("?","");s+="/"+i,r.push(s)}else s+="/"+n}),r.filter((n,i,o)=>o.indexOf(n)===i)},_e=t=>/[%+]/.test(t)?(t.indexOf("+")!==-1&&(t=t.replace(/\+/g," ")),t.indexOf("%")!==-1?Te(t):t):t,ht=(t,e,r)=>{let s;if(!r&&e&&!/[%+]/.test(e)){let o=t.indexOf(`?${e}`,8);for(o===-1&&(o=t.indexOf(`&${e}`,8));o!==-1;){const h=t.charCodeAt(o+e.length+1);if(h===61){const c=o+e.length+2,u=t.indexOf("&",c);return _e(t.slice(c,u===-1?void 0:u))}else if(h==38||isNaN(h))return"";o=t.indexOf(`&${e}`,o+1)}if(s=/[%+]/.test(t),!s)return}const n={};s??(s=/[%+]/.test(t));let i=t.indexOf("?",8);for(;i!==-1;){const o=t.indexOf("&",i+1);let h=t.indexOf("=",i);h>o&&o!==-1&&(h=-1);let c=t.slice(i+1,h===-1?o===-1?void 0:o:h);if(s&&(c=_e(c)),i=o,c==="")continue;let u;h===-1?u="":(u=t.slice(h+1,o===-1?void 0:o),s&&(u=_e(u))),r?(n[c]&&Array.isArray(n[c])||(n[c]=[]),n[c].push(u)):n[c]??(n[c]=u)}return e?n[e]:n},Tt=ht,Ft=(t,e)=>ht(t,e,!0),Te=decodeURIComponent,ze=t=>at(t,Te),ae,C,W,lt,ft,Ie,B,Xe,ut=(Xe=class{constructor(t,e="/",r=[[]]){g(this,W);d(this,"raw");g(this,ae);g(this,C);d(this,"routeIndex",0);d(this,"path");d(this,"bodyCache",{});g(this,B,t=>{const{bodyCache:e,raw:r}=this,s=e[t];if(s)return s;const n=Object.keys(e)[0];return n?e[n].then(i=>(n==="json"&&(i=JSON.stringify(i)),new Response(i)[t]())):e[t]=r[t]()});this.raw=t,this.path=e,f(this,C,r),f(this,ae,{})}param(t){return t?p(this,W,lt).call(this,t):p(this,W,ft).call(this)}query(t){return Tt(this.url,t)}queries(t){return Ft(this.url,t)}header(t){if(t)return this.raw.headers.get(t)??void 0;const e={};return this.raw.headers.forEach((r,s)=>{e[s]=r}),e}async parseBody(t){var e;return(e=this.bodyCache).parsedBody??(e.parsedBody=await jt(this,t))}json(){return a(this,B).call(this,"json")}text(){return a(this,B).call(this,"text")}arrayBuffer(){return a(this,B).call(this,"arrayBuffer")}blob(){return a(this,B).call(this,"blob")}formData(){return a(this,B).call(this,"formData")}addValidatedData(t,e){a(this,ae)[t]=e}valid(t){return a(this,ae)[t]}get url(){return this.raw.url}get method(){return this.raw.method}get matchedRoutes(){return a(this,C)[0].map(([[,t]])=>t)}get routePath(){return a(this,C)[0].map(([[,t]])=>t)[this.routeIndex].path}},ae=new WeakMap,C=new WeakMap,W=new WeakSet,lt=function(t){const e=a(this,C)[0][this.routeIndex][1][t],r=p(this,W,Ie).call(this,e);return r?/\%/.test(r)?ze(r):r:void 0},ft=function(){const t={},e=Object.keys(a(this,C)[0][this.routeIndex][1]);for(const r of e){const s=p(this,W,Ie).call(this,a(this,C)[0][this.routeIndex][1][r]);s&&typeof s=="string"&&(t[r]=/\%/.test(s)?ze(s):s)}return t},Ie=function(t){return a(this,C)[1]?a(this,C)[1][t]:t},B=new WeakMap,Xe),Mt={Stringify:1},dt=async(t,e,r,s,n)=>{typeof t=="object"&&!(t instanceof String)&&(t instanceof Promise||(t=t.toString()),t instanceof Promise&&(t=await t));const i=t.callbacks;return i!=null&&i.length?(n?n[0]+=t:n=[t],Promise.all(i.map(h=>h({phase:e,buffer:n,context:s}))).then(h=>Promise.all(h.filter(Boolean).map(c=>dt(c,e,!1,s,n))).then(()=>n[0]))):Promise.resolve(t)},qt="text/plain; charset=UTF-8",De=(t,e={})=>{for(const r of Object.keys(e))t.set(r,e[r]);return t},ye,we,T,Y,F,m,b,A,M,me,oe,ce,ve,be,k,$,Je,Ut=(Je=class{constructor(t,e){g(this,k);g(this,ye);g(this,we);d(this,"env",{});g(this,T);d(this,"finalized",!1);d(this,"error");g(this,Y,200);g(this,F);g(this,m);g(this,b);g(this,A);g(this,M,!0);g(this,me);g(this,oe);g(this,ce);g(this,ve);g(this,be);d(this,"render",(...t)=>(a(this,oe)??f(this,oe,e=>this.html(e)),a(this,oe).call(this,...t)));d(this,"setLayout",t=>f(this,me,t));d(this,"getLayout",()=>a(this,me));d(this,"setRenderer",t=>{f(this,oe,t)});d(this,"header",(t,e,r)=>{if(this.finalized&&f(this,A,new Response(a(this,A).body,a(this,A))),e===void 0){a(this,m)?a(this,m).delete(t):a(this,b)&&delete a(this,b)[t.toLocaleLowerCase()],this.finalized&&this.res.headers.delete(t);return}r!=null&&r.append?(a(this,m)||(f(this,M,!1),f(this,m,new Headers(a(this,b))),f(this,b,{})),a(this,m).append(t,e)):a(this,m)?a(this,m).set(t,e):(a(this,b)??f(this,b,{}),a(this,b)[t.toLowerCase()]=e),this.finalized&&(r!=null&&r.append?this.res.headers.append(t,e):this.res.headers.set(t,e))});d(this,"status",t=>{f(this,M,!1),f(this,Y,t)});d(this,"set",(t,e)=>{a(this,T)??f(this,T,new Map),a(this,T).set(t,e)});d(this,"get",t=>a(this,T)?a(this,T).get(t):void 0);d(this,"newResponse",(...t)=>p(this,k,$).call(this,...t));d(this,"body",(t,e,r)=>typeof e=="number"?p(this,k,$).call(this,t,e,r):p(this,k,$).call(this,t,e));d(this,"text",(t,e,r)=>{if(!a(this,b)){if(a(this,M)&&!r&&!e)return new Response(t);f(this,b,{})}return a(this,b)["content-type"]=qt,typeof e=="number"?p(this,k,$).call(this,t,e,r):p(this,k,$).call(this,t,e)});d(this,"json",(t,e,r)=>{const s=JSON.stringify(t);return a(this,b)??f(this,b,{}),a(this,b)["content-type"]="application/json",typeof e=="number"?p(this,k,$).call(this,s,e,r):p(this,k,$).call(this,s,e)});d(this,"html",(t,e,r)=>(a(this,b)??f(this,b,{}),a(this,b)["content-type"]="text/html; charset=UTF-8",typeof t=="object"?dt(t,Mt.Stringify,!1,{}).then(s=>typeof e=="number"?p(this,k,$).call(this,s,e,r):p(this,k,$).call(this,s,e)):typeof e=="number"?p(this,k,$).call(this,t,e,r):p(this,k,$).call(this,t,e)));d(this,"redirect",(t,e)=>(a(this,m)??f(this,m,new Headers),a(this,m).set("Location",String(t)),this.newResponse(null,e??302)));d(this,"notFound",()=>(a(this,ce)??f(this,ce,()=>new Response),a(this,ce).call(this,this)));f(this,ye,t),e&&(f(this,F,e.executionCtx),this.env=e.env,f(this,ce,e.notFoundHandler),f(this,be,e.path),f(this,ve,e.matchResult))}get req(){return a(this,we)??f(this,we,new ut(a(this,ye),a(this,be),a(this,ve))),a(this,we)}get event(){if(a(this,F)&&"respondWith"in a(this,F))return a(this,F);throw Error("This context has no FetchEvent")}get executionCtx(){if(a(this,F))return a(this,F);throw Error("This context has no ExecutionContext")}get res(){return f(this,M,!1),a(this,A)||f(this,A,new Response("404 Not Found",{status:404}))}set res(t){if(f(this,M,!1),a(this,A)&&t){t=new Response(t.body,t);for(const[e,r]of a(this,A).headers.entries())if(e!=="content-type")if(e==="set-cookie"){const s=a(this,A).headers.getSetCookie();t.headers.delete("set-cookie");for(const n of s)t.headers.append("set-cookie",n)}else t.headers.set(e,r)}f(this,A,t),this.finalized=!0}get var(){return a(this,T)?Object.fromEntries(a(this,T)):{}}},ye=new WeakMap,we=new WeakMap,T=new WeakMap,Y=new WeakMap,F=new WeakMap,m=new WeakMap,b=new WeakMap,A=new WeakMap,M=new WeakMap,me=new WeakMap,oe=new WeakMap,ce=new WeakMap,ve=new WeakMap,be=new WeakMap,k=new WeakSet,$=function(t,e,r){if(a(this,M)&&!r&&!e&&a(this,Y)===200)return new Response(t,{headers:a(this,b)});if(e&&typeof e!="number"){const n=new Headers(e.headers);a(this,m)&&a(this,m).forEach((o,h)=>{h==="set-cookie"?n.append(h,o):n.set(h,o)});const i=De(n,a(this,b));return new Response(t,{headers:i,status:e.status??a(this,Y)})}const s=typeof e=="number"?e:a(this,Y);a(this,b)??f(this,b,{}),a(this,m)??f(this,m,new Headers),De(a(this,m),a(this,b)),a(this,A)&&(a(this,A).headers.forEach((n,i)=>{var o,h;i==="set-cookie"?(o=a(this,m))==null||o.append(i,n):(h=a(this,m))==null||h.set(i,n)}),De(a(this,m),a(this,b))),r??(r={});for(const[n,i]of Object.entries(r))if(typeof i=="string")a(this,m).set(n,i);else{a(this,m).delete(n);for(const o of i)a(this,m).append(n,o)}return new Response(t,{status:s,headers:a(this,m)})},Je),E="ALL",Wt="all",zt=["get","post","put","delete","options","patch"],gt="Can not add a route since the matcher is already built.",pt=class extends Error{},Bt="__COMPOSED_HANDLER",Kt=t=>t.text("404 Not Found",404),Be=(t,e)=>{if("getResponse"in t){const r=t.getResponse();return e.newResponse(r.body,r)}return console.error(t),e.text("Internal Server Error",500)},_,x,wt,D,X,Re,Pe,Ye,yt=(Ye=class{constructor(e={}){g(this,x);d(this,"get");d(this,"post");d(this,"put");d(this,"delete");d(this,"options");d(this,"patch");d(this,"all");d(this,"on");d(this,"use");d(this,"router");d(this,"getPath");d(this,"_basePath","/");g(this,_,"/");d(this,"routes",[]);g(this,D,Kt);d(this,"errorHandler",Be);d(this,"onError",e=>(this.errorHandler=e,this));d(this,"notFound",e=>(f(this,D,e),this));d(this,"fetch",(e,...r)=>p(this,x,Pe).call(this,e,r[1],r[0],e.method));d(this,"request",(e,r,s,n)=>e instanceof Request?this.fetch(r?new Request(e,r):e,s,n):(e=e.toString(),this.fetch(new Request(/^https?:\/\//.test(e)?e:`http://localhost${ie("/",e)}`,r),s,n)));d(this,"fire",()=>{addEventListener("fetch",e=>{e.respondWith(p(this,x,Pe).call(this,e.request,e,void 0,e.request.method))})});[...zt,Wt].forEach(i=>{this[i]=(o,...h)=>(typeof o=="string"?f(this,_,o):p(this,x,X).call(this,i,a(this,_),o),h.forEach(c=>{p(this,x,X).call(this,i,a(this,_),c)}),this)}),this.on=(i,o,...h)=>{for(const c of[o].flat()){f(this,_,c);for(const u of[i].flat())h.map(l=>{p(this,x,X).call(this,u.toUpperCase(),a(this,_),l)})}return this},this.use=(i,...o)=>(typeof i=="string"?f(this,_,i):(f(this,_,"*"),o.unshift(i)),o.forEach(h=>{p(this,x,X).call(this,E,a(this,_),h)}),this);const{strict:s,...n}=e;Object.assign(this,n),this.getPath=s??!0?e.getPath??ot:Nt}route(e,r){const s=this.basePath(e);return r.routes.map(n=>{var o;let i;r.errorHandler===Be?i=n.handler:(i=async(h,c)=>(await Ue([],r.errorHandler)(h,()=>n.handler(h,c))).res,i[Bt]=n.handler),p(o=s,x,X).call(o,n.method,n.path,i)}),this}basePath(e){const r=p(this,x,wt).call(this);return r._basePath=ie(this._basePath,e),r}mount(e,r,s){let n,i;s&&(typeof s=="function"?i=s:(i=s.optionHandler,s.replaceRequest===!1?n=c=>c:n=s.replaceRequest));const o=i?c=>{const u=i(c);return Array.isArray(u)?u:[u]}:c=>{let u;try{u=c.executionCtx}catch{}return[c.env,u]};n||(n=(()=>{const c=ie(this._basePath,e),u=c==="/"?0:c.length;return l=>{const y=new URL(l.url);return y.pathname=y.pathname.slice(u)||"/",new Request(y,l)}})());const h=async(c,u)=>{const l=await r(n(c.req.raw),...o(c));if(l)return l;await u()};return p(this,x,X).call(this,E,ie(e,"*"),h),this}},_=new WeakMap,x=new WeakSet,wt=function(){const e=new yt({router:this.router,getPath:this.getPath});return e.errorHandler=this.errorHandler,f(e,D,a(this,D)),e.routes=this.routes,e},D=new WeakMap,X=function(e,r,s){e=e.toUpperCase(),r=ie(this._basePath,r);const n={path:r,method:e,handler:s};this.router.add(e,r,[s,n]),this.routes.push(n)},Re=function(e,r){if(e instanceof Error)return this.errorHandler(e,r);throw e},Pe=function(e,r,s,n){if(n==="HEAD")return(async()=>new Response(null,await p(this,x,Pe).call(this,e,r,s,"GET")))();const i=this.getPath(e,{env:s}),o=this.router.match(n,i),h=new Ut(e,{path:i,matchResult:o,env:s,executionCtx:r,notFoundHandler:a(this,D)});if(o[0].length===1){let u;try{u=o[0][0][0][0](h,async()=>{h.res=await a(this,D).call(this,h)})}catch(l){return p(this,x,Re).call(this,l,h)}return u instanceof Promise?u.then(l=>l||(h.finalized?h.res:a(this,D).call(this,h))).catch(l=>p(this,x,Re).call(this,l,h)):u??a(this,D).call(this,h)}const c=Ue(o[0],this.errorHandler,a(this,D));return(async()=>{try{const u=await c(h);if(!u.finalized)throw new Error("Context is not finalized. Did you forget to return a Response object or `await next()`?");return u.res}catch(u){return p(this,x,Re).call(this,u,h)}})()},Ye),ke="[^/]+",ge=".*",pe="(?:|/.*)",de=Symbol(),Vt=new Set(".\\+*[^]$()");function Gt(t,e){return t.length===1?e.length===1?t<e?-1:1:-1:e.length===1||t===ge||t===pe?1:e===ge||e===pe?-1:t===ke?1:e===ke?-1:t.length===e.length?t<e?-1:1:e.length-t.length}var Z,ee,H,Ze,Ne=(Ze=class{constructor(){g(this,Z);g(this,ee);g(this,H,Object.create(null))}insert(e,r,s,n,i){if(e.length===0){if(a(this,Z)!==void 0)throw de;if(i)return;f(this,Z,r);return}const[o,...h]=e,c=o==="*"?h.length===0?["","",ge]:["","",ke]:o==="/*"?["","",pe]:o.match(/^\:([^\{\}]+)(?:\{(.+)\})?$/);let u;if(c){const l=c[1];let y=c[2]||ke;if(l&&c[2]&&(y=y.replace(/^\((?!\?:)(?=[^)]+\)$)/,"(?:"),/\((?!\?:)/.test(y)))throw de;if(u=a(this,H)[y],!u){if(Object.keys(a(this,H)).some(w=>w!==ge&&w!==pe))throw de;if(i)return;u=a(this,H)[y]=new Ne,l!==""&&f(u,ee,n.varIndex++)}!i&&l!==""&&s.push([l,a(u,ee)])}else if(u=a(this,H)[o],!u){if(Object.keys(a(this,H)).some(l=>l.length>1&&l!==ge&&l!==pe))throw de;if(i)return;u=a(this,H)[o]=new Ne}u.insert(h,r,s,n,i)}buildRegExpStr(){const r=Object.keys(a(this,H)).sort(Gt).map(s=>{const n=a(this,H)[s];return(typeof a(n,ee)=="number"?`(${s})@${a(n,ee)}`:Vt.has(s)?`\\${s}`:s)+n.buildRegExpStr()});return typeof a(this,Z)=="number"&&r.unshift(`#${a(this,Z)}`),r.length===0?"":r.length===1?r[0]:"(?:"+r.join("|")+")"}},Z=new WeakMap,ee=new WeakMap,H=new WeakMap,Ze),je,Ee,et,Qt=(et=class{constructor(){g(this,je,{varIndex:0});g(this,Ee,new Ne)}insert(t,e,r){const s=[],n=[];for(let o=0;;){let h=!1;if(t=t.replace(/\{[^}]+\}/g,c=>{const u=`@\\${o}`;return n[o]=[u,c],o++,h=!0,u}),!h)break}const i=t.match(/(?::[^\/]+)|(?:\/\*$)|./g)||[];for(let o=n.length-1;o>=0;o--){const[h]=n[o];for(let c=i.length-1;c>=0;c--)if(i[c].indexOf(h)!==-1){i[c]=i[c].replace(h,n[o][1]);break}}return a(this,Ee).insert(i,e,s,a(this,je),r),s}buildRegExp(){let t=a(this,Ee).buildRegExpStr();if(t==="")return[/^$/,[],[]];let e=0;const r=[],s=[];return t=t.replace(/#(\d+)|@(\d+)|\.\*\$/g,(n,i,o)=>i!==void 0?(r[++e]=Number(i),"$()"):(o!==void 0&&(s[Number(o)]=++e),"")),[new RegExp(`^${t}`),r,s]}},je=new WeakMap,Ee=new WeakMap,et),mt=[],Xt=[/^$/,[],Object.create(null)],Se=Object.create(null);function vt(t){return Se[t]??(Se[t]=new RegExp(t==="*"?"":`^${t.replace(/\/\*$|([.\\+*[^\]$()])/g,(e,r)=>r?`\\${r}`:"(?:|/.*)")}$`))}function Jt(){Se=Object.create(null)}function Yt(t){var u;const e=new Qt,r=[];if(t.length===0)return Xt;const s=t.map(l=>[!/\*|\/:/.test(l[0]),...l]).sort(([l,y],[w,O])=>l?1:w?-1:y.length-O.length),n=Object.create(null);for(let l=0,y=-1,w=s.length;l<w;l++){const[O,j,v]=s[l];O?n[j]=[v.map(([L])=>[L,Object.create(null)]),mt]:y++;let S;try{S=e.insert(j,y,O)}catch(L){throw L===de?new pt(j):L}O||(r[y]=v.map(([L,se])=>{const le=Object.create(null);for(se-=1;se>=0;se--){const[I,Le]=S[se];le[I]=Le}return[L,le]}))}const[i,o,h]=e.buildRegExp();for(let l=0,y=r.length;l<y;l++)for(let w=0,O=r[l].length;w<O;w++){const j=(u=r[l][w])==null?void 0:u[1];if(!j)continue;const v=Object.keys(j);for(let S=0,L=v.length;S<L;S++)j[v[S]]=h[j[v[S]]]}const c=[];for(const l in o)c[l]=r[o[l]];return[i,c,n]}function ne(t,e){if(t){for(const r of Object.keys(t).sort((s,n)=>n.length-s.length))if(vt(r).test(e))return[...t[r]]}}var K,V,ue,bt,Et,tt,Zt=(tt=class{constructor(){g(this,ue);d(this,"name","RegExpRouter");g(this,K);g(this,V);f(this,K,{[E]:Object.create(null)}),f(this,V,{[E]:Object.create(null)})}add(t,e,r){var h;const s=a(this,K),n=a(this,V);if(!s||!n)throw new Error(gt);s[t]||[s,n].forEach(c=>{c[t]=Object.create(null),Object.keys(c[E]).forEach(u=>{c[t][u]=[...c[E][u]]})}),e==="/*"&&(e="*");const i=(e.match(/\/:/g)||[]).length;if(/\*$/.test(e)){const c=vt(e);t===E?Object.keys(s).forEach(u=>{var l;(l=s[u])[e]||(l[e]=ne(s[u],e)||ne(s[E],e)||[])}):(h=s[t])[e]||(h[e]=ne(s[t],e)||ne(s[E],e)||[]),Object.keys(s).forEach(u=>{(t===E||t===u)&&Object.keys(s[u]).forEach(l=>{c.test(l)&&s[u][l].push([r,i])})}),Object.keys(n).forEach(u=>{(t===E||t===u)&&Object.keys(n[u]).forEach(l=>c.test(l)&&n[u][l].push([r,i]))});return}const o=ct(e)||[e];for(let c=0,u=o.length;c<u;c++){const l=o[c];Object.keys(n).forEach(y=>{var w;(t===E||t===y)&&((w=n[y])[l]||(w[l]=[...ne(s[y],l)||ne(s[E],l)||[]]),n[y][l].push([r,i-u+c+1]))})}}match(t,e){Jt();const r=p(this,ue,bt).call(this);return this.match=(s,n)=>{const i=r[s]||r[E],o=i[2][n];if(o)return o;const h=n.match(i[0]);if(!h)return[[],mt];const c=h.indexOf("",1);return[i[1][c],h]},this.match(t,e)}},K=new WeakMap,V=new WeakMap,ue=new WeakSet,bt=function(){const t=Object.create(null);return Object.keys(a(this,V)).concat(Object.keys(a(this,K))).forEach(e=>{t[e]||(t[e]=p(this,ue,Et).call(this,e))}),f(this,K,f(this,V,void 0)),t},Et=function(t){const e=[];let r=t===E;return[a(this,K),a(this,V)].forEach(s=>{const n=s[t]?Object.keys(s[t]).map(i=>[i,s[t][i]]):[];n.length!==0?(r||(r=!0),e.push(...n)):t!==E&&e.push(...Object.keys(s[E]).map(i=>[i,s[E][i]]))}),r?Yt(e):null},tt),G,q,rt,er=(rt=class{constructor(t){d(this,"name","SmartRouter");g(this,G,[]);g(this,q,[]);f(this,G,t.routers)}add(t,e,r){if(!a(this,q))throw new Error(gt);a(this,q).push([t,e,r])}match(t,e){if(!a(this,q))throw new Error("Fatal error");const r=a(this,G),s=a(this,q),n=r.length;let i=0,o;for(;i<n;i++){const h=r[i];try{for(let c=0,u=s.length;c<u;c++)h.add(...s[c]);o=h.match(t,e)}catch(c){if(c instanceof pt)continue;throw c}this.match=h.match.bind(h),f(this,G,[h]),f(this,q,void 0);break}if(i===n)throw new Error("Fatal error");return this.name=`SmartRouter + ${this.activeRouter.name}`,o}get activeRouter(){if(a(this,q)||a(this,G).length!==1)throw new Error("No active router has been determined yet.");return a(this,G)[0]}},G=new WeakMap,q=new WeakMap,rt),fe=Object.create(null),Q,P,te,he,R,U,J,st,xt=(st=class{constructor(t,e,r){g(this,U);g(this,Q);g(this,P);g(this,te);g(this,he,0);g(this,R,fe);if(f(this,P,r||Object.create(null)),f(this,Q,[]),t&&e){const s=Object.create(null);s[t]={handler:e,possibleKeys:[],score:0},f(this,Q,[s])}f(this,te,[])}insert(t,e,r){f(this,he,++qe(this,he)._);let s=this;const n=_t(e),i=[];for(let c=0,u=n.length;c<u;c++){const l=n[c],y=n[c+1],w=We(l,y),O=Array.isArray(w)?w[0]:l;if(Object.keys(a(s,P)).includes(O)){s=a(s,P)[O];const j=We(l,y);j&&i.push(j[1]);continue}a(s,P)[O]=new xt,w&&(a(s,te).push(w),i.push(w[1])),s=a(s,P)[O]}const o=Object.create(null),h={handler:r,possibleKeys:i.filter((c,u,l)=>l.indexOf(c)===u),score:a(this,he)};return o[t]=h,a(s,Q).push(o),s}search(t,e){var h;const r=[];f(this,R,fe);let n=[this];const i=it(e),o=[];for(let c=0,u=i.length;c<u;c++){const l=i[c],y=c===u-1,w=[];for(let O=0,j=n.length;O<j;O++){const v=n[O],S=a(v,P)[l];S&&(f(S,R,a(v,R)),y?(a(S,P)["*"]&&r.push(...p(this,U,J).call(this,a(S,P)["*"],t,a(v,R))),r.push(...p(this,U,J).call(this,S,t,a(v,R)))):w.push(S));for(let L=0,se=a(v,te).length;L<se;L++){const le=a(v,te)[L],I=a(v,R)===fe?{}:{...a(v,R)};if(le==="*"){const z=a(v,P)["*"];z&&(r.push(...p(this,U,J).call(this,z,t,a(v,R))),f(z,R,I),w.push(z));continue}if(l==="")continue;const[Le,Fe,xe]=le,N=a(v,P)[Le],Pt=i.slice(c).join("/");if(xe instanceof RegExp){const z=xe.exec(Pt);if(z){if(I[Fe]=z[0],r.push(...p(this,U,J).call(this,N,t,a(v,R),I)),Object.keys(a(N,P)).length){f(N,R,I);const $e=((h=z[0].match(/\//))==null?void 0:h.length)??0;(o[$e]||(o[$e]=[])).push(N)}continue}}(xe===!0||xe.test(l))&&(I[Fe]=l,y?(r.push(...p(this,U,J).call(this,N,t,I,a(v,R))),a(N,P)["*"]&&r.push(...p(this,U,J).call(this,a(N,P)["*"],t,I,a(v,R)))):(f(N,R,I),w.push(N)))}}n=w.concat(o.shift()??[])}return r.length>1&&r.sort((c,u)=>c.score-u.score),[r.map(({handler:c,params:u})=>[c,u])]}},Q=new WeakMap,P=new WeakMap,te=new WeakMap,he=new WeakMap,R=new WeakMap,U=new WeakSet,J=function(t,e,r,s){const n=[];for(let i=0,o=a(t,Q).length;i<o;i++){const h=a(t,Q)[i],c=h[e]||h[E],u={};if(c!==void 0&&(c.params=Object.create(null),n.push(c),r!==fe||s&&s!==fe))for(let l=0,y=c.possibleKeys.length;l<y;l++){const w=c.possibleKeys[l],O=u[c.score];c.params[w]=s!=null&&s[w]&&!O?s[w]:r[w]??(s==null?void 0:s[w]),u[c.score]=!0}}return n},st),re,nt,tr=(nt=class{constructor(){d(this,"name","TrieRouter");g(this,re);f(this,re,new xt)}add(t,e,r){const s=ct(e);if(s){for(let n=0,i=s.length;n<i;n++)a(this,re).insert(t,s[n],r);return}a(this,re).insert(t,e,r)}match(t,e){return a(this,re).search(t,e)}},re=new WeakMap,nt),rr=class extends yt{constructor(t={}){super(t),this.router=t.router??new er({routers:[new Zt,new tr]})}},sr=(t,e={fetch:globalThis.fetch.bind(globalThis)})=>r=>{r.respondWith((async()=>{const s=await t.fetch(r.request);return e.fetch&&s.status===404?await e.fetch(r.request):s})())},nr=({limitLength:t=255,headerName:e="X-Request-Id",generator:r=()=>crypto.randomUUID()}={})=>async function(n,i){let o=e?n.req.header(e):void 0;(!o||o.length>t||/[^\w\-]/.test(o))&&(o=r(n)),n.set("requestId",o),e&&n.header(e,o),await i()},Ot=()=>{try{return performance.now()}catch{}return Date.now()},ir=t=>{const e={total:!0,enabled:!0,totalDescription:"Total Response Time",autoEnd:!0,crossOrigin:!1,...t};return async function(s,n){const i=[],o=new Map;if(s.get("metric"))return await n();if(s.set("metric",{headers:i,timers:o}),e.total&&or(s,"total",e.totalDescription),await n(),e.total&&Ke(s,"total"),e.autoEnd&&o.forEach((c,u)=>Ke(s,u)),typeof e.enabled=="function"?e.enabled(s):e.enabled){s.res.headers.append("Server-Timing",i.join(","));const c=typeof e.crossOrigin=="function"?e.crossOrigin(s):e.crossOrigin;c&&s.res.headers.append("Timing-Allow-Origin",typeof c=="string"?c:"*")}}},ar=(t,e,r,s,n)=>{const i=t.get("metric");if(!i){console.warn("Metrics not initialized! Please add the `timing()` middleware to this route!");return}if(typeof r=="number"){const o=r.toFixed(1),h=s?`${e};dur=${o};desc="${s}"`:`${e};dur=${o}`;i.headers.push(h)}else{const o=r?`${e};desc="${r}"`:`${e}`;i.headers.push(o)}},or=(t,e,r)=>{const s=t.get("metric");if(!s){console.warn("Metrics not initialized! Please add the `timing()` middleware to this route!");return}s.timers.set(e,{description:r,start:Ot()})},Ke=(t,e,r)=>{const s=t.get("metric");if(!s){console.warn("Metrics not initialized! Please add the `timing()` middleware to this route!");return}const n=s.timers.get(e);if(!n){console.warn(`Timer "${e}" does not exist!`);return}const{description:i,start:o}=n,h=Ot()-o;ar(t,e,h,i),s.timers.delete(e)},cr=(t,e)=>{if(!t)return e;const r=new Uint8Array(t.byteLength+e.byteLength);return r.set(new Uint8Array(t),0),r.set(e,t.byteLength),r},hr=async(t,e)=>{if(!t)return null;let r;const s=t.getReader();for(;;){const{value:n,done:i}=await s.read();if(i)break;r=await e(cr(r,n))}return r?Array.prototype.map.call(new Uint8Array(r),n=>n.toString(16).padStart(2,"0")).join(""):null},ur=["cache-control","content-location","date","etag","expires","vary"],Ve=t=>t.replace(/^W\//,"");function lr(t,e){return e!=null&&e.split(/,\s*/).some(r=>Ve(r)===Ve(t))}function fr(t){return t||crypto&&crypto.subtle&&(t=e=>crypto.subtle.digest({name:"SHA-1"},e)),t}var dr=t=>{const e=ur,r=fr(t==null?void 0:t.generateDigest);return async function(n,i){const o=n.req.header("If-None-Match")??null;await i();const h=n.res;let c=h.headers.get("ETag");if(!c){if(!r)return;const u=await hr(h.clone().body,r);if(u===null)return;c=`"${u}"`}lr(c,o)?(n.res=new Response(null,{status:304,statusText:"Not Modified",headers:{ETag:c}}),n.res.headers.forEach((u,l)=>{e.indexOf(l.toLowerCase())===-1&&n.res.headers.delete(l)})):n.res.headers.set("ETag",c)}},gr=t=>async function(r,s){await s(),r.res.headers.set("X-Powered-By",t==null?void 0:t.serverName)},pr=/^[\w!#$%&'*.^`|~+-]+$/,yr=/^[ !#-:<-[\]-~]*$/,Ge=(t,e)=>{if(e&&t.indexOf(e)===-1)return{};const r=t.trim().split(";"),s={};for(let n of r){n=n.trim();const i=n.indexOf("=");if(i===-1)continue;const o=n.substring(0,i).trim();if(e&&e!==o||!pr.test(o))continue;let h=n.substring(i+1).trim();if(h.startsWith('"')&&h.endsWith('"')&&(h=h.slice(1,-1)),yr.test(h)&&(s[o]=Te(h),e))break}return s},wr=(t,e,r={})=>{let s=`${t}=${e}`;if(t.startsWith("__Secure-")&&!r.secure)throw new Error("__Secure- Cookie must have Secure attributes");if(t.startsWith("__Host-")){if(!r.secure)throw new Error("__Host- Cookie must have Secure attributes");if(r.path!=="/")throw new Error('__Host- Cookie must have Path attributes with "/"');if(r.domain)throw new Error("__Host- Cookie must not have Domain attributes")}if(r&&typeof r.maxAge=="number"&&r.maxAge>=0){if(r.maxAge>3456e4)throw new Error("Cookies Max-Age SHOULD NOT be greater than 400 days (34560000 seconds) in duration.");s+=`; Max-Age=${r.maxAge|0}`}if(r.domain&&r.prefix!=="host"&&(s+=`; Domain=${r.domain}`),r.path&&(s+=`; Path=${r.path}`),r.expires){if(r.expires.getTime()-Date.now()>3456e7)throw new Error("Cookies Expires SHOULD NOT be greater than 400 days (34560000 seconds) in the future.");s+=`; Expires=${r.expires.toUTCString()}`}if(r.httpOnly&&(s+="; HttpOnly"),r.secure&&(s+="; Secure"),r.sameSite&&(s+=`; SameSite=${r.sameSite.charAt(0).toUpperCase()+r.sameSite.slice(1)}`),r.priority&&(s+=`; Priority=${r.priority}`),r.partitioned){if(!r.secure)throw new Error("Partitioned Cookie must have Secure attributes");s+="; Partitioned"}return s},He=(t,e,r)=>(e=encodeURIComponent(e),wr(t,e,r)),mr=(t,e,r)=>{const s=t.req.raw.headers.get("Cookie");if(typeof e=="string"){if(!s)return;let i=e;return Ge(s,i)[i]}return s?Ge(s):{}},vr=(t,e,r,s)=>{let n;(s==null?void 0:s.prefix)==="secure"?n=He("__Secure-"+e,r,{path:"/",...s,secure:!0}):(s==null?void 0:s.prefix)==="host"?n=He("__Host-"+e,r,{...s,path:"/",secure:!0,domain:void 0}):n=He(e,r,{path:"/",...s}),t.header("Set-Cookie",n,{append:!0})},br=t=>t?t.split(",").map((r,s)=>({value:r,index:s})).map(xr).filter(r=>!!r).sort(Pr).map(({type:r,params:s,q:n})=>({type:r,params:s,q:n})):[],Er=/;(?=(?:(?:[^"]*"){2})*[^"]*$)/,xr=({value:t,index:e})=>{const r=t.trim().split(Er).map(o=>o.trim()),s=r[0];if(!s)return null;const n=Or(r.slice(1)),i=Rr(n.q);return{type:s,params:n,q:i,index:e}},Or=t=>t.reduce((e,r)=>{const[s,n]=r.split("=").map(i=>i.trim());return s&&n&&(e[s]=n),e},{}),Rr=t=>{if(t===void 0||t==="")return 1;if(t==="NaN")return 0;const e=Number(t);return e===1/0?1:e===-1/0?0:Number.isNaN(e)||e<0||e>1?1:e},Pr=(t,e)=>{const r=e.q-t.q;return r!==0?r:t.index-e.index},Qe={order:["querystring","cookie","header"],lookupQueryString:"lang",lookupCookie:"language",lookupFromHeaderKey:"accept-language",lookupFromPathIndex:0,caches:["cookie"],ignoreCase:!0,fallbackLanguage:"en",supportedLanguages:["en"],cookieOptions:{sameSite:"Strict",secure:!0,maxAge:365*24*60*60,httpOnly:!0},debug:!1};function Sr(t){return br(t).map(({type:e,q:r})=>({lang:e,q:r}))}var Ae=(t,e)=>{if(t)try{let r=t.trim();e.convertDetectedLanguage&&(r=e.convertDetectedLanguage(r));const s=e.ignoreCase?r.toLowerCase():r,n=e.supportedLanguages.map(o=>e.ignoreCase?o.toLowerCase():o),i=n.find(o=>o===s);return i?e.supportedLanguages[n.indexOf(i)]:void 0}catch{return}},kr=(t,e)=>{try{const r=t.req.query(e.lookupQueryString);return Ae(r,e)}catch{return}},jr=(t,e)=>{try{const r=mr(t,e.lookupCookie);return Ae(r,e)}catch{return}};function Ar(t,e){try{const r=t.req.header(e.lookupFromHeaderKey);if(!r)return;const s=Sr(r);for(const{lang:n}of s){const i=Ae(n,e);if(i)return i}return}catch{return}}function Lr(t,e){try{const s=t.req.path.split("/").filter(Boolean)[e.lookupFromPathIndex];return Ae(s,e)}catch{return}}var Rt={querystring:kr,cookie:jr,header:Ar,path:Lr};function $r(t){if(!t.supportedLanguages.includes(t.fallbackLanguage))throw new Error("Fallback language must be included in supported languages");if(t.lookupFromPathIndex<0)throw new Error("Path index must be non-negative");if(!t.order.every(e=>Object.keys(Rt).includes(e)))throw new Error("Invalid detector type in order array")}function Cr(t,e,r){if(!(!Array.isArray(r.caches)||!r.caches.includes("cookie")))try{vr(t,r.lookupCookie,e,r.cookieOptions)}catch(s){r.debug&&console.error("Failed to cache language:",s)}}var _r=(t,e)=>{let r;for(const n of e.order){const i=Rt[n];if(i)try{if(r=i(t,e),r){e.debug&&console.log(`Language detected from ${n}: ${r}`);break}}catch(o){e.debug&&console.error(`Error in ${n} detector:`,o);continue}}const s=r||e.fallbackLanguage;return r&&e.caches&&Cr(t,s,e),s},Dr=t=>{const e={...Qe,...t,cookieOptions:{...Qe.cookieOptions,...t.cookieOptions}};return $r(e),async function(s,n){try{const i=_r(s,e);s.set("language",i)}catch(i){e.debug&&console.error("Language detection failed:",i),s.set("language",e.fallbackLanguage)}await n()}};const Hr=new rr,Ir=Hr.use(nr(),ir(),dr(),gr({serverName:"sw"}),Dr({supportedLanguages:["ja","en"],fallbackLanguage:"ja"})).basePath("/sw").get("/:id?/:path?",async t=>{const{id:e,path:r}=t.req.param();return r?t.json({id:e,path:r,env:t.env}):e?t.text(e):t.text(crypto.randomUUID())});self.addEventListener("fetch",sr(Ir));self.addEventListener("install",async t=>{console.log("sw install"),t.waitUntil(self.skipWaiting())});self.addEventListener("activate",async t=>{console.log("sw activate"),t.waitUntil(self.clients.claim())});
